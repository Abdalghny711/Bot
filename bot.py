import osimport certififrom pyrogram import Client, errorsimport telebotfrom telebot import typesimport threadingimport asynciofrom backend import appfrom db import databaseDB = database()App = app()os.environ['SSL_CERT_FILE'] = certifi.where()api_id = '20662205'api_hash = '8f1754a96f4db97c9db22dfc7b68b597'TELEGRAM_TOKEN = "7696711925:AAGNsGUEwGF3JXiza2Y_gIHTd_4zZc1wh6g"bot = telebot.TeleBot(TELEGRAM_TOKEN, threaded=False, num_threads=55, skip_pending=True)# Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†ADMIN_IDS = [1621709020, 6374412293]  # Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ù€ ID Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†# Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª ÙˆØ§Ù„ØªÙˆØ§ØµÙ„bot_status = {"active": True}communication_status = {"active": False}@bot.message_handler(commands=['start'])def main_menu(message):    AddAccount = types.InlineKeyboardButton("Ø§Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ ğŸ›", callback_data="AddAccount")    Accounts = types.InlineKeyboardButton("Ø§ÙƒÙˆØ§Ø¯ Ø­Ø³Ø§Ø¨Ø§ØªÙƒ ğŸ–²", callback_data="Accounts")    a1 = types.InlineKeyboardButton("Ù†Ù‚Ù„ Ø£Ø¹Ø¶Ø§Ø¡ ğŸ‘¤ğŸ˜‡", callback_data="a1")    admin_panel = types.InlineKeyboardButton("Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ğŸ› ", callback_data="admin_panel")    inline = types.InlineKeyboardMarkup([[a1], [AddAccount], [Accounts], [admin_panel]])    bot.send_message(        message.chat.id,        """*Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹Ø§Ø®ØªØ± Ù…Ø§ ØªØ±ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¯Ù†Ø§Ù‡ ğŸ”¥ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ù‚Ù„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ù„Ø¬Ø±ÙˆØ¨Ùƒ ğŸ›Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ø§Ù„Ù…ØªØ§Ø­Ø© â˜„Creator: @S3_9B*""",        reply_markup=inline,        parse_mode="markdown"    )@bot.callback_query_handler(lambda call: True)def handle_callbacks(call):    if call.data == "Accounts":        num = DB.accounts()        bot.edit_message_text(            chat_id=call.message.chat.id,            message_id=call.message.message_id,            text=f"Ø­Ø³Ø§Ø¨Ø§ØªÙƒ Ø§Ù„Ù…Ø³Ø¬Ù„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„: {num}",            parse_mode="markdown"        )    elif call.data == "AddAccount":        msg = bot.edit_message_text(            chat_id=call.message.chat.id,            message_id=call.message.message_id,            text="*Ù‚Ù… Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„Ù‡ Ù…Ø¹ Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¢Ù†* ğŸ“ğŸ©",            parse_mode="markdown"        )        bot.register_next_step_handler(msg, add_account)    elif call.data == "a1":        msg = bot.edit_message_text(            chat_id=call.message.chat.id,            message_id=call.message.message_id,            text="*Ù‚Ù… Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø±ÙˆØ¨ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ù„Ù†Ù‚Ù„ Ù…Ù†Ù‡* ğŸ–²",            parse_mode="markdown"        )        bot.register_next_step_handler(msg, statement)    elif call.data == "admin_panel":        admin_panel(call.message)def admin_panel(message):    if message.chat.id in ADMIN_IDS:        activate_bot = types.InlineKeyboardButton("ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ÙˆØª âœ…", callback_data="activate_bot")        deactivate_bot = types.InlineKeyboardButton("ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¨ÙˆØª âŒ", callback_data="deactivate_bot")        add_admin = types.InlineKeyboardButton("Ø±ÙØ¹ Ù…Ø´Ø±Ù ğŸ‘¤", callback_data="add_admin")        remove_admin = types.InlineKeyboardButton("ØªÙ†Ø²ÙŠÙ„ Ù…Ø´Ø±Ù ğŸš«", callback_data="remove_admin")        enable_communication = types.InlineKeyboardButton("ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙˆØ§ØµÙ„ ğŸ’¬", callback_data="enable_communication")        disable_communication = types.InlineKeyboardButton("ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªÙˆØ§ØµÙ„ ğŸ›‘", callback_data="disable_communication")        bot_members = types.InlineKeyboardButton("Ø¹Ø¯Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¨ÙˆØª ğŸ“Š", callback_data="bot_members")        markup = types.InlineKeyboardMarkup(            [[activate_bot, deactivate_bot], [add_admin, remove_admin],             [enable_communication, disable_communication], [bot_members]]        )        bot.send_message(message.chat.id, "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ğŸ› :", reply_markup=markup)    else:        bot.send_message(message.chat.id, "âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.")@bot.callback_query_handler(func=lambda call: True)def admin_commands(call):    if call.data == "activate_bot":        bot_status["active"] = True        bot.answer_callback_query(call.id, "âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ÙˆØª!")    elif call.data == "deactivate_bot":        bot_status["active"] = False        bot.answer_callback_query(call.id, "âŒ ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¨ÙˆØª!")    elif call.data == "add_admin":        msg = bot.send_message(call.message.chat.id, "ğŸ‘¤ Ø£Ø±Ø³Ù„ Ø¢ÙŠØ¯ÙŠ Ø§Ù„Ø¹Ø¶Ùˆ Ù„Ø±ÙØ¹Ù‡ ÙƒÙ…Ø´Ø±Ù:")        bot.register_next_step_handler(msg, add_admin_step)    elif call.data == "remove_admin":        msg = bot.send_message(call.message.chat.id, "ğŸš« Ø£Ø±Ø³Ù„ Ø¢ÙŠØ¯ÙŠ Ø§Ù„Ù…Ø´Ø±Ù Ù„ØªÙ†Ø²ÙŠÙ„Ù‡:")        bot.register_next_step_handler(msg, remove_admin_step)    elif call.data == "enable_communication":        communication_status["active"] = True        bot.answer_callback_query(call.id, "âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙˆØ§ØµÙ„!")    elif call.data == "disable_communication":        communication_status["active"] = False        bot.answer_callback_query(call.id, "âŒ ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªÙˆØ§ØµÙ„!")    elif call.data == "bot_members":        num_members = DB.get_bot_members()  # Ø§ÙØªØ±Ø¶ Ø£Ù† Ù„Ø¯ÙŠÙƒ ÙˆØ¸ÙŠÙØ© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡        bot.send_message(call.message.chat.id, f"ğŸ“Š Ø¹Ø¯Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¨ÙˆØª: {num_members}")def add_account(message):    try:        if "+" in message.text:            bot.send_message(message.chat.id, "*Ø§Ù†ØªØ¸Ø± Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ* â±", parse_mode="markdown")            _client = Client("::memory::", in_memory=True, api_id=api_id, api_hash=api_hash, lang_code="ar")            _client.connect()            SendCode = _client.send_code(message.text)            Mas = bot.send_message(message.chat.id, "*Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…Ø±Ø³Ù„ Ø¥Ù„ÙŠÙƒ ğŸ”*", parse_mode="markdown")            bot.register_next_step_handler(Mas, sign_up, _client, message.text, SendCode.phone_code_hash, message.text)        else:            bot.send_message(message.chat.id, "*ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­.*")    except Exception as e:        bot.send_message(message.chat.id, f"ERORR : {e}")def sign_up(message, _client, phone, hash, name):    try:        bot.send_message(message.chat.id, "*Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ â±*", parse_mode="markdown")        _client.sign_in(phone, hash, message.text)        bot.send_message(message.chat.id, "*ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ… *", parse_mode="markdown")        ses = _client.export_session_string()        DB.AddAcount(ses, name, message.chat.id)    except errors.SessionPasswordNeeded:        Mas = bot.send_message(message.chat.id, "*Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø­Ø³Ø§Ø¨Ùƒ ğŸ”*", parse_mode="markdown")        bot.register_next_step_handler(Mas, add_password, _client, name)def add_password(message, _client, name):    try:        _client.check_password(message.text)        ses = _client.export_session_string()        DB.AddAcount(ses, name, message.chat.id)        bot.send_message(message.chat.id, "*ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…*", parse_mode="markdown")        _client.stop()    except Exception as e:        bot.send_message(message.chat.id, f"ERORR : {e}")# Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø´Ø±Ù@bot.message_handler(func=lambda message: communication_status["active"])def forward_to_admin(message):    for admin_id in ADMIN_IDS:        bot.forward_message(admin_id, message.chat.id, message.message_id)# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª@bot.message_handler(func=lambda message: not bot_status["active"])def bot_disabled(message):    bot.send_message(message.chat.id, "âŒ Ø§Ù„Ø¨ÙˆØª Ù…Ø¹Ø·Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.")bot.infinity_polling(none_stop=True, timeout=15, long_polling_timeout=15)